# MVP 출시 우선순위 정리 (배틀패스/성인콘텐츠 제외)

## 0. 범위 정의
- 제외: 배틀패스 전 기능, AdultContent 관련 전 기능, 심리 측정 퀴즈, 실시간(WebSocket/라이브 통계), 업적/리더보드/소셜, 고급 프로모션/한정 패키지(선택 연기).
- 목표: 인증 → 코어 게임(슬롯/가챠) → 행동로깅 → 보상/통화 → 상점/구매 → 기본 대시보드 폐쇄 루프 안정화.

## 1. MUST (출시 전 필수)
### 1.1 인프라 & 안정성
- ⚠️ 주요 테이블/인덱스/제약조건 설계 확정 (1차 감사/제안 완료 → 마이그레이션 적용 중)
- ✅ 백업/복구 전략 수립 + 스크립트/Runbook 작성 (실제 복구 스모크 예정)
- ✅ 로깅 설정 (구조화 JSON + request_id/user_id contextvars 적용)
- ✅ 에러 핸들링 미들웨어 (표준 오류 스키마 + 도메인/HTTP/Validation 통합)
- ✅ 사용자 정의 예외 클래스 (AuthError, AuthorizationError, NotFoundError 등 도입)
- ✅ API 문서화(OpenAPI export: canonical + timestamped snapshot 생성 스크립트)

### 1.2 인증/사용자
- [❌] JWT 인증 및 권한 관리 (초대코드/닉네임 기반, VIP 필드 존재만)
- [❌] 초기 사용자 설정 (등급/초기 통화 기본값) 
- [⚠️] 코드 보안: DEFAULT_INVITE_CODE 난수화 & 환경변수화

### 1.3 코어 게임 루프 & 피드백
- [ ] SlotMachineComponent (프론트 + 서버 결과/보상 API)
- [ ] GachaSpinComponent (기본 확률/결과 반환)
- [ ] 피드백 알림 시스템 (토스트/메시지 최소)
- [⚠️] 사용자 행동 로깅 API (DB 기록) — Kafka→OLAP 연동은 이후

### 1.4 게임 데이터/통계
- [ ] 게임 핸드 데이터 저장 (user_id, game_type, result, payout, ts)
- [ ] 승률/수익률 계산 로직 (집계 쿼리 or 캐시)

- [✅] 게임별 상세 통계 구현
- [✅] 게임 히스토리 조회 기능
- [ ] WebSocket 연동
- [ ] 실시간 게임 세션 모니터링
- [ ] 라이브 통계 업데이트
- [ ] 푸시 알림 연동
- [ ] 업적 시스템 구현
- [ ] 배지 및 보상 UI
- [ ] 리더보드 기능


## 관리자 기능 점검 결과 (요약)

### 1.5 상점/과금
- [ ] 상점 상품 관리/표시 (Premium Gem, 기본 패키지)
- [ ] 구매 로직 (POST /api/shop/buy) 멱등 + 통화 차감
- [ ] 화폐 시스템 (Regular/Premium 잔액 컬럼 및 적립/차감 서비스)
- (선택) 한정 패키지 / 프로모션 관리: 시간 부족 시 LATER 이동

### 1.6 프론트 사용자 여정
- [ ] 랜딩 페이지 (Hero + 초대코드 진입)
- [ ] 초대코드 입력 화면
- [ ] 회원가입/로그인 모달
- [ ] 온보딩 튜토리얼 (2~3 스텝 최소)
- [ ] 홈 대시보드 (잔액/최근 보상/슬롯·가챠 진입)

### 1.7 테스트 (최소 품질 게이트)
- [❌] 단위 테스트 핵심(인증, 구매, 게임 보상, 행동 로깅)
- [❌] 통합 테스트: 온보딩→슬롯/가챠→구매→잔액 검증 흐름

### 1.8 VIP (표시 최소)
- [ ] VIP 등급 표시(읽기) — 업그레이드 로직 세부는 SHOULD/LATER

## 2. SHOULD (시간 남으면)
- [⚠️] 백업/복구 스크립트(ps1) 고도화 & 자동화 체크
- [⚠️] 특별 보상 처리(이벤트/프로모) 기본 enum 설계
- [⚠️] 출석 달력 데이터 모델(엔드포인트/캘린더 UI 제외)
- [⚠️] 보호/복구 옵션(스트릭 보호) 컬럼/플래그 예약
- [ ] VIP 혜택/업그레이드 UI 보강(비교표, 진행률 바)
- [ ] 피드백 메시지/애니메이션 키 세분화 맵핑
- [ ] 개인화된 추천 UI 스켈레톤 (빈 데이터 시 placeholder)
- [ ] 추천 API 엔드포인트 스켈레톤(200 + TODO 주석)

## 3. LATER (MVP 이후)
- Kafka→OLAP 실시간 행동 분석 파이프라인
- 로그 압축/아카이빙
- 스트릭 레벨/복구 혜택 UI
- 세그먼트 기반 추천 실제 알고리즘 & 사이버 토큰 미션
- RFM 배치/세그먼트 히스토리 추적
- Capture 다중 재시도 정책 파라미터화 / 부분 환불 보정 로직
- VIP 업/다운그레이드 정책 & 자동화
- 온보딩 확장형 튜토리얼/고급 효과
- 고급 프로모션/한정 패키지 로테이션
- WebSocket 실시간 모니터링 / 라이브 통계 / 푸시
- 업적 시스템 / 배지 UI / 리더보드 / 소셜 기능
- 성능 최적화(고빈도 액션 샤딩, 캐시 계층화)

## 4. DROP / EXCLUDE (현 스코프 제외)
- 영수증 발행 및 기록 (🚫)
- AdultContent 관련 모든 항목 (StageComponent, 퀴즈, UI/API)
- 배틀패스 전체 기능
- 심리 측정 퀴즈(제출/분석 API + UI)

## 5. 수량 개요 (상위 MUST)
| 영역 | MUST 항목 수(상위) |
|------|------------------|
| 인프라/안정성 | 6 |
| 인증/사용자 | 3 |
| 코어 게임 & 피드백 | 4 |
| 게임 데이터/통계 | 2 |
| 상점/과금 | 3~4 |
| 프론트 여정 | 6 |
| 테스트 | 2 |
| VIP 표시 | 1 |
| 합계 | 약 27 |

## 6. 실행 순서 (추천 스프린트 흐름)
1) DB 스키마 & 제약조건 확정 → 초기 마이그레이션 / Alembic 단일 head 유지
2) 인증 + 사용자 초기값 + 초대코드 난수화
3) 슬롯/가챠 서비스 & 보상 계산 + 행동 로깅 API (DB)
4) 상점/구매 트랜잭션 + 화폐 시스템 → 홈 대시보드 연결
5) 프론트 온보딩 흐름(랜딩→가입/로그인→튜토리얼→게임 진입)
6) 로깅/에러/예외 + OpenAPI 정비
7) 핵심 단위/통합 테스트 및 CI 기준 잠금
8) 백업 스모크 & VIP 표기 마감 → MVP 태그

## 7. 완료 정의(Definition of Done) 체크
- 인증/구매/슬롯/가챠/피드백/로깅/데이터 저장 End-to-End 테스트 통과
- 마이그레이션: alembic heads 단일 유지 + downgrade 스모크
- OpenAPI 최신화(`current_openapi.json`) 반영
- 백업 덤프/복구 1회 성공 로그 기록
- 핵심 경로 테스트 커버리지 ≥60~65% (향후 80% 목표 에스컬레이션)

---
(원본 상세 목록은 재분류·축약됨. 세부 하위 태스크는 이 문서 기반으로 Issue/Ticket 생성 권장.)
