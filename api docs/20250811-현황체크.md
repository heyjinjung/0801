# Casino-Club F2P — 프로젝트 현황 체크 (2025-08-11)

본 문서는 현재 코드/인프라/문서의 상태를 체크박스로 요약합니다. Option A(스키마 베이스라인 고정) 채택 기준으로 작성되었습니다.

## 운영 원칙
- [x] Alembic 단일 head 유지 (현재: 20250811_add_invite_codes)
- [x] 기존 운영 스키마를 베이스라인으로 채택하여 alembic stamp head 적용
- [x] 이후 마이그레이션은 head 이후의 델타만 수행
- [x] CI에서 alembic upgrade head 가드 활성화(CI_ENFORCE_ALEMBIC_UPGRADE=1)

## Backend (FastAPI)
- [x] /health 200 응답 및 로깅 초기화
- [x] 인증: /api/auth/signup, /login, /admin/login, /refresh 동작
- [x] JWT 발급/검증/만료/리프레시 동작 (AuthService)
- [x] RBAC: 관리자 전용(/api/invite/generate) 일반 사용자 접근 금지 테스트 통과
- [x] Rank 유틸: check_rank_access, check_combined_access 단위 테스트 통과
- [x] 초대코드: /api/invite/validate, /codes, /codes/{code}/deactivate, /stats
- [x] Kafka 비활성 시 동작(502 허용) 표준화
- [ ] Rank 기반 라우터 적용(선택 경로들에 등급 요구사항 연결)

## Database (PostgreSQL)
- [x] 컨테이너 health OK, SELECT 1 OK
- [x] alembic heads → 단일 head 확인
- [x] upgrade head는 DuplicateTable 발생(현존 스키마) → stamp head로 해결
- [x] 이후 마이그레이션은 델타만 수행(Option A)
- [ ] 주기적 백업/복구 절차 스크립트화 및 문서화 강화

## Redis/Kafka
- [x] Redis 컨테이너 기동 및 health OK
- [x] Kafka/Zookeeper 컨테이너 기동(선택), Kafka 미사용 시 API 502 허용
- [ ] Kafka round-trip 소비자 안정화(옵션)

## Frontend (Next.js)
- [x] dev 서버 기동 및 200 응답
- [ ] OpenAPI 기반 타입/클라이언트 동기화 자동화(옵션)

## 테스트/문서
- [x] 스모크 테스트: health, invite+signup+login+me, refresh PASS
- [x] RBAC/Rank minimal 테스트 PASS
- [x] OpenAPI 재수출 완료(current_openapi.json 갱신)
- [x] 006 가이드 최신화(베이스라인/포트/검증 로그 반영)
- [x] CI Alembic 업그레이드 가드 활성화
- [ ] CI 배지 추가(가드 활성화는 완료)
- [ ] /api/invite/validate E2E 테스트(app/tests/test_invite_validate.py) 추가 및 PASS

## 다음 단계 제안
- [x] CI_ENFORCE_ALEMBIC_UPGRADE=1 활성화하여 마이그레이션 가드 적용
- [ ] 일부 라우터에 Rank 요구조건 연결 및 테스트 추가
- [ ] 정기 백업/복구 파이프라인 문서화 및 스크립트 제공
- [ ] Kafka consumer 라운드트립 안정화(필요 시)
- [ ] app/tests/test_invite_validate.py 작성(유효/만료/사용초과/미존재 코드 + 응답 포맷)
- [ ] InviteCode 모델↔DB 스키마 정합성 재검증 및 필요 시 마이그레이션 보강

---

변경 요약
- Alembic: 단일 head 확인 및 stamp head 적용으로 운영 스키마 베이스라인 확정
- 인증/JWT/리프레시/RBAC/Rank 유틸 검증 및 최소 테스트 통과
- OpenAPI 재수출 및 006 문서 반영 완료
 - CI Alembic 업그레이드 가드 활성화

검증 결과
- 컨테이너 헬스 OK, 스모크/신규 테스트 PASS, /docs 정상 노출, 단일 head 유지

다음 단계
- CI 가드 활성화, Rank 라우터 적용 확대, 백업/복구 자동화 강화

## 백로그(가이드 006 미이관 항목 전체 반영)

아래 항목들은 가이드 006 하단의 미체크 과제를 백로그로 이관한 목록입니다. 진행되면 본문 체크리스트 섹션으로 승격해 상태를 갱신합니다.

### Backend APIs/도메인
- [ ] 슬롯 게임 API (POST /api/actions/SLOT_SPIN) — 확률/스트릭/보상 로직, 액션 로깅
- [ ] 가챠 스핀 API (POST /api/games/gacha/pull) — 루트 테이블/천장/지급/히스토리
- [ ] 보상 지급 API (POST /api/rewards) — 원자성/idem-potency/히스토리/알림
- [ ] 사용자 행동 로깅 API (POST /api/actions) — 대용량/필터링/아카이빙
- [ ] 실시간 알림 API (SSE/WebSocket) — 연결/재연결/멀티플렉싱/필터링
- [ ] 개인화 추천 API (GET /recommend/personalized)
- [ ] 심리 측정 퀴즈 제출/분석 API (POST /api/quiz/submit)
- [ ] 성인 콘텐츠 해금 API (POST /api/unlock) — 연령 확인/단계/차감
- [ ] VIP 등급 업그레이드 API — 요건/혜택/히스토리/알림
- [ ] 회원/보상/아이템/캠페인 관리자 API들 CRUD 및 권한

### Kafka/실시간
- [ ] Kafka Consumer 라운드트립 안정화(assignment 대기, ready 플래그, 테스트 backoff)
- [ ] 스키마 레지스트리 연동(필요 시)

### 테스트/관측/문서화
- [ ] 단위 테스트(서비스/리포지토리) 보강
- [ ] 통합 테스트(API 엔드포인트) 보강
- [ ] 구조화 로깅 도입 및 필드 표준화
- [ ] 에러 핸들링 미들웨어/사용자 정의 예외 클래스
- [ ] OpenAPI 문서 자동화/검증 파이프라인 강화

### 데이터/배치/분석
- [ ] RFM 세그먼트 배치(APSheduler) — Recency/Frequency/Monetary 계산 및 업데이트
- [ ] 모니터링/대시보드(Grafana/Metabase) 연동
- [ ] 실시간 스트리밍 파이프라인(Kafka→ClickHouse 등) 설계/연동
- [ ] A/B 테스트 프레임워크/행동 분석 도구 연동

### 데이터베이스
- [ ] 핵심 테이블 구체화: users, user_segments, user_actions, user_rewards, gacha_log, shop_transactions
- [ ] 인덱스/쿼리 최적화/보안 설정 점검
- [ ] 백업/복구 전략 자동화(스크립트/가이드)

### 상점/결제
- [ ] 상점/프리미엄 젬 구매 API (POST /api/shop/buy)
- [ ] 한정 패키지/프로모션 관리
- [ ] 외부 결제 게이트웨이 연동/웹훅/서명 검증/재시도
- [ ] 트랜잭션 일관성/동시성 제어 및 감사 로깅

### Frontend(UI/UX)
- [ ] Tailwind/Framer Motion/다크 네온 테마 마감
- [ ] 반응형/접근성/SEO 최적화
- [ ] 랜딩/초대코드 UI/온보딩 튜토리얼
- [ ] 대시보드/SlotMachineComponent/GachaSpinComponent/피드백 알림
- [ ] BattlePassComponent/개인화 추천 UI/알림 센터/소셜 증명/스트릭 표시
- [ ] ShopComponent/VIP 혜택 UI/결제 모달
- [ ] 프론트엔드 테스트(Jest/RTL) 보강
