# Casino-Club F2P 통합/정비 가이드 (2025-08-08)

## 1. 현황 및 문제 요약

- **중복 파일 다수**: `_simple`, `_fixed`, `_temp`, `_direct`, `_v2` 등 접미사로 분기된 파일이 많아 유지보수 혼란.
- **API 라우터 중복/불일치**: games, game_api, game_api_v2 등 유사 기능이 여러 파일에 분산되어 일관성 저하.
- **환경/설정 파일 중복**: config.py, config_simple.py 등 환경설정이 분리되어 통합 배포/운영에 문제.
- **풀스택 연결 오류**: 프론트-백엔드, DB, 인증 등 연결이 불안정하거나 일부 경로가 동작하지 않음.
- **문서/스펙 불일치**: README, API 문서, 실제 코드가 다름.

---

## 2. 통합 및 정비 원칙

- **단일 진입점/단일 소스 유지**: 동일 목적의 파일은 하나만 남기고, 개선점은 통합.
- **모듈별 책임 명확화**: 인증, 게임, 유저, 관리 등 도메인별로 라우터/서비스/스키마 분리.
- **환경설정 일원화**: config.py 하나로 통합, .env 사용 권장.
- **API 스펙/문서 자동화**: OpenAPI/Swagger 기반 문서 자동 생성.
- **테스트/배포 자동화**: 통합 테스트, CI/CD 파이프라인 구축.

---

## 3. 단계별 통합/정비 체크리스트

### 1) 중복 파일 정리
- [x] *_simple.py, *_fixed.py, *_temp.py, *_direct.py, *_v2.py 등 불필요 파일 삭제
- [x] main.py, auth.py, games.py 등 핵심 파일만 남기고 통합
- [x] config.py, dependencies.py 등 환경/의존성 파일 단일화

### 2) API 라우터/스키마 통합
- [x] games.py에 game_api, game_api_v2 기능 병합
- [x] auth.py에 simple/clean/temp 기능 병합
- [x] 스키마 정의 (game_schemas.py 등) 중복 제거 및 통일
- [x] OpenAPI 스펙 재생성 및 문서화 (파일: `cc-webapp/backend/current_openapi.json`)

### 3) 환경설정/배포 통합
- [x] config.py 단일화 및 .env 적용
 - [x] docker-compose.yml, requirements.txt 등 배포 파일 정비 (compose version 키 제거, env 정렬)
 - [x] README/가이드 최신화 (Canonical OpenAPI 위치/Export 절차 반영)

### 4) 풀스택 연결성 점검
 - [ ] 프론트엔드-백엔드 API 경로/스펙 일치 확인
 - [x] DB 마이그레이션/초기화 스크립트 점검 (games 테이블 최소 스키마 + seed 적용)
 - [x] 인증/권한/세션 연동 테스트 (signup→login→보호 엔드포인트 호출 검증)

### 5) 테스트/자동화
- [ ] 통합 테스트 코드 작성 (pytest 등)
- [ ] CI/CD 파이프라인 구축 (GitHub Actions 등)

---

## 4. 베스트 프랙티스 & 주의사항

- **모든 통합/삭제 작업 전 git backup 브랜치 생성**
- **통합 후 반드시 전체 테스트/로컬 실행 검증**
- **API 변경 시 프론트엔드/문서/테스트 코드 동시 수정**
- **불필요한 주석/코드/파일은 즉시 제거**
- **문서(README, API docs) 최신 상태 유지**

---

## 5. 참고 문서
- FILE_CONSOLIDATION_REPORT.md
- file-comparison-report.md
- README-SIMPLE.md

---

## 6. 빠른 점검용 체크리스트 (복붙용)

 - [x] 중복 파일/모듈 모두 삭제
 - [x] 핵심 라우터/서비스/스키마만 남겼는지 확인
- [ ] config.py/.env만 남기고 환경설정 통일
- [x] API 문서/스펙 최신화 (OpenAPI 갱신 및 경로 표준화)
- [ ] 프론트-백엔드 연결 정상 동작 확인
- [ ] 전체 테스트 통과
- [ ] git commit/backup 완료

---

> 문의/이슈: 담당자 또는 README 참고

---

## 7. Canonical OpenAPI 위치 및 관리 기준

- Canonical 파일: `cc-webapp/backend/current_openapi.json`
 - 중복 파일 정리: 루트 `cc-webapp/current_openapi.json` 제거 완료
- 생성 방식: 컨테이너 내부에서 `python -m app.export_openapi` 실행 시 자동 갱신

## 8. Next Steps

 - [완료] RPS 플레이 엔드포인트 OperationId 정리: 고유 `operation_id` = `games_rps_play_v1`
 - [다음] 프론트-백엔드 경로/스키마 최종 동기화 체크 및 최소 UI 스모크 플로우
 - [다음] 통합 테스트 보강 및 CI/CD 파이프라인 구축 (GitHub Actions 등)
 - [다음] DB 마이그레이션 정식화 (Alembic) 및 초기 데이터 시드 스크립트 편입

---

Update Log (2025-08-08):
- 서버 부팅/헬스 체크 통과 (/health OK)
- OpenAPI 재생성 완료 (`backend/current_openapi.json`)
 - 루트 `cc-webapp/current_openapi.json` 제거 완료 (중복 소스 정리)
 - 컨테이너 내 smoke test (signup→login→games→rps) 통과
 - games 테이블 생성(없을 시) 및 샘플 seed 적용
 - RPS `operation_id` 고정: `games_rps_play_v1` (POST `/api/games/rps/play`)
